# 買う機能のバランス分析

## 概要

~~現在の買う機能のパラメータ（年数・距離・UFOサイズ）が購入結果にどのような影響を与えるかを分析する。~~

**2025-06-20 更新**: 新バランス仕様に変更済み。投資額に対して±10%の予測可能な戻りを実現。

## パラメータ仕様

### 1. 年数（Years）
- **範囲**: 1～1000年
- **コスト影響**: `cost = (年数 × 距離) × UFOサイズ`
- **レア度影響**: `year_bonus = min(年数 * 0.02, 2.0)` (最大2.0倍)
- **アイテム状態影響**: 古いほど劣化率上昇

### 2. 距離（Distance）
- **範囲**: 0～50,000km
- **コスト影響**: `cost = (年数 × 距離) × UFOサイズ`
- **レア度影響**: `distance_bonus = min(距離 * 0.001, 1.5)` (最大1.5倍)
- **コンボ効果**: `combo_bonus = (年数 × 距離) * 0.00001`

### 3. UFOサイズ
- **範囲**: 1.0～10.0倍
- **コスト影響**: 最終的なコスト倍率
- **アイテム数**: `max(1, min(8, int(UFOサイズ)))` 個
- **容量制限**: 最大8個まで

## コスト計算式

```
総コスト = (年数 × 距離) × UFOサイズ
```

### コスト例
- 年数100、距離1000、UFO1.0 → 100,000円
- 年数500、距離10000、UFO5.0 → 25,000,000円

## レア度計算式

```
レア度倍率 = 1.0 + year_bonus + distance_bonus + combo_bonus

year_bonus = min(年数 * 0.02, 2.0)
distance_bonus = min(距離 * 0.001, 1.5)
combo_bonus = min((年数 × 距離) * 0.00001, 1.0)
```

### レア度ランク
- **コモン**: < 1.5倍
- **レア**: 1.5～2.5倍
- **ウルトラレア**: 2.5～4.0倍
- **伝説**: 4.0～5.5倍
- **神話**: > 5.5倍

## アイテム価値計算

```
最終価値 = 基本価値(100-1000) × 状態倍率 × レア度倍率

状態倍率:
- A（新品）: 1.0倍
- B（良品）: 0.8倍
- C（劣化）: 0.6倍
```

## バランス分析の課題

### 1. コスト効率性
- 極端なパラメータでのコスト爆発
- 低レベルパラメータでの利益率
- 失敗率10%の影響

### 2. リスク・リターン
- 高コスト投資の妥当性
- UFOサイズ vs 個数の効率
- 年数・距離の最適バランス

### 3. ゲーム進行
- 初期資金1000円からの成長曲線
- 中盤以降の投資戦略
- エンドゲームでの最適解

## 次の調査項目

1. **パラメータ別収益性分析**
   - 各パラメータの投資効率
   - 最適な組み合わせの特定

2. **シミュレーション実行**
   - 様々なパラメータでの期待値計算
   - 失敗率を含む実際の収益性

3. **可視化**
   - コスト vs 期待収益のグラフ
   - パラメータ別の効率マップ

## ~~発見された問題点~~ → 解決済み (2025-06-20)

### ~~1. コストスケーリングの問題~~ → **解決**
- ~~年数×距離の乗算により、コストが急激に増加~~
- ~~UFOサイズがさらに倍率をかけるため、コスト爆発が発生~~
- **新仕様**: 投資額から±10%の予測可能な戻りを実現

### ~~2. レア度ボーナスの上限~~ → **解決**
- ~~year_bonus最大2.0倍、distance_bonus最大1.5倍で上限あり~~
- ~~combo_bonusも最大1.0倍で、極端な投資の見返りが限定的~~
- **新仕様**: レア度は表示用のみ、実際の価値は投資額から逆算

### ~~3. アイテム数の制限~~ → **解決**
- ~~UFOサイズが10.0でも最大8個までしか取得できない~~
- ~~大型UFOの投資効率が悪化~~
- **新仕様**: アイテム数2-5個固定、UFOサイズは純粋にコスト倍率

## 新仕様の実装結果

### 実装済み機能
1. **予測可能な戻り**: 投資額 × (0.9～1.1) = 期待価値合計
2. **固定アイテム数**: 2～5個（UFOサイズ無関係）
3. **価値分配**: 目標総価値を個別アイテムに±40%バリエーションで分配
4. **装飾的属性**: 状態・レア度は表示用として維持

### 変更点
- **`app.py`**: 買う機能の価値計算ロジックを完全書き換え
- **アイテム数計算**: `max(1, min(8, int(ufo_size)))` → `random.randint(2, 5)`
- **価値計算**: ランダム基本価値×倍率 → 投資額からの逆算分配

これで安定した基盤が完成し、次段階での大きな増減ロジック追加が容易になった。