# 現在の実装仕様

**更新条件**: ゲームシステム・バランス・技術アーキテクチャの実装変更時

**最終更新**: 2025-06-21  
**フェーズ**: 2.3完了 - 戦略的購買システム確立  
**ルール**: このファイルは現在の実装に基づく最新仕様のみを記載します

## システム概要

タイムトラベル仕入れ・オークションゲーム。過去で商品を購入し、現代でオークション売却して利益を得る戦略ゲーム。

### 基本ゲームフロー
1. **購買**: 年数・距離を指定してタイムトラベル購買
2. **売却**: AIオークションで商品売却
3. **成長**: 価格倍率曲線により1～10倍の可変成長

## 購買システム

### コスト計算
```
投資コスト = 年数 × 距離
固定費（UFO代金） = 資産 × 5%
```

### パラメータ制限
- **年数**: 1～1,000,000年
- **距離**: 0～1,000,000km

### 商品生成
- **個数**: 2～5個（ランダム）
- **価値**: 投資コスト × 価格倍率 / 商品数
- **バリエーション**: 各商品±10%の価値変動

## 価格倍率システム（フェーズ2.3）

### 大ターン・子ターンシステム
- **大ターン**: 8子ターンを含む上位単位
- **子ターン**: プレイヤーの1回の購買行動
- **ターン進行**: 購買実行時に自動進行

### 価格倍率曲線
- **目標倍率**: 1.0～10.0倍（大ターン開始時にランダム決定）
- **各ターン乗数**: 0.5～2.0倍（8ターン分）
- **実現精度**: 目標倍率±0.05の誤差で達成
- **生成アルゴリズム**: 10回試行して最適解採用

### 戦略的要素
- **目標倍率表示**: UI上で現在の目標倍率確認可能
- **投資判断**: 高倍率時は積極投資、低倍率時は控えめ投資
- **リスク管理**: 固定費を考慮した資産管理

## 資産・ゲームオーバーシステム

### 資産計算
```
総資産 = 現金 + 在庫価値合計
在庫価値 = Σ(各商品のbase_value)
```

### ゲームオーバー条件
```
総資産 < UFO代金（固定費） = ゲームオーバー
```

### ゲームオーバー時の処理
1. メッセージ表示
2. リセットUI表示
3. 操作制限（購買・売却無効化）

## オークションシステム

### AIバイヤー
- **人数**: 各オークションで15人生成
- **評価**: 商品価値に基づく動的評価
- **入札**: リアルタイム競り上げ
- **入札閾値**: 0.3（商品価値の30%以上で入札）
- **パラメータ範囲**: 
  - condition: 0.3-1.2
  - rarity: 0.6-1.8  
  - price: 0.3-1.5

### オークション進行
- **時間**: 自動進行（現在の設定）
- **手数料**: 売却価格の10%
- **結果**: 最高入札者が落札

## 商品システム

### 商品属性
- **ジャンル**: 10カテゴリ（家電、玩具、服飾等）
- **状態**: A（新品）、B（良品）、C（劣化）
- **レア度**: 表示用属性（実際の価値は価格倍率で決定）

### 価値計算
```
商品価値 = (投資コスト × 価格倍率) / 商品数 × バリエーション
```

## 技術アーキテクチャ

### 3層分離設計
```
core/     - ゲームロジック層
api/      - JSON API層
templates/ - UI層
```

### 主要モジュール
- `core/turn_system.py` - ターンシステム・価格倍率曲線
- `core/asset_manager.py` - 資産管理・固定費
- `core/item_system.py` - 商品生成・価値計算
- `core/auction_system.py` - オークション・AIバイヤー
- `core/game_engine.py` - 全体統合・状態管理

### 設定ファイル
- `core/phase2_config.py` - フェーズ2.3設定
- `core/travel_config.py` - 旅行パラメータ設定

### ファイル構成詳細
- `core/turn_system.py` - ターンシステム・価格倍率曲線
- `core/asset_manager.py` - 資産管理・固定費計算
- `core/item_system.py` - 商品生成・価値計算  
- `core/auction_system.py` - オークション・AIバイヤー
- `core/game_engine.py` - 全体統合・状態管理
- `templates/sell.html` - 売却UI（663行）
- `templates/buy.html` - 購買UI（509行）
- `templates/debug.html` - デバッグ情報表示

## 現在のバランス

### 初期設定
- **初期資金**: 1000円
- **固定費率**: 5%
- **子ターン数**: 8ターン/大ターン

### 成長期待値
- **最小成長**: 1.0倍（投資額と同等）
- **最大成長**: 10.0倍（投資額の10倍）
- **戦略差**: プレイヤーの判断により結果が変動

## UI・操作

### 購買画面
- 年数・距離入力
- 目標倍率表示
- 資産・固定費表示
- 自動投資機能
- `/api/auto_invest` APIエンドポイント

### 売却画面
- 在庫一覧表示
- オークション設定
- 全部出品機能
- リアルタイム入札表示

### デバッグ画面
- 資産推移グラフ
- ターン状況表示
- 価格曲線可視化

---

**注意**: 
- この仕様は現在の実装（フェーズ2.3完了時点）に基づいています
- 過去の仕様や開発経緯は `DEVELOPMENT_HISTORY.md` を参照してください
- 開発ツール・テストは `tools/` フォルダを参照してください